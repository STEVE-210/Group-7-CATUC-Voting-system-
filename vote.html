<!DOCTYPE html>
<html>
<head>
    <title>CATUC VoteSmart - Voting Page</title>
    <style>
        body{font-family:Arial;background:#e9f3ff;margin:0;padding:0;}
        .container{width:400px;margin:auto;margin-top:80px;background:white;padding:20px;border-radius:6px;}
        button{width:100%;padding:10px;margin-top:15px;background:blue;color:white;border:none;border-radius:5px;}
        h2{text-align:center;color:blue;}
        label{display:block;margin-top:10px;}
        header {
    background-color: #004aad; 
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
}

.logo-left, .logo-right {
    height: 60px;
}

header h1 {
    color: white;
    font-size: 22px;
    text-align: center;
    margin: 0;
    flex-grow: 1;
}

    </style>
</head>
<body>
<header>
        <img src="logo.png.jpg" class="logo-left">
        <h1>üó≥Ô∏è CATUC VoteSmart</h1>
        <img src="logo.png.jpg" class="logo-right">
    </header>

<div class="container">

   <h2>Vote for: <span id="campaignTitle"></span></h2>
<div id="candidateList"></div>

<button onclick="submitVote()">Submit Vote</button>

    <p id="msg" style="color:green;font-weight:600;"></p>
</div>

<script>
    let currentStudent = localStorage.getItem("currentStudent");

let voters = JSON.parse(localStorage.getItem("voters")) || [];
let candidates = JSON.parse(localStorage.getItem("candidates")) || [];

let thisStudent = voters.find(v => v.matricule === currentStudent);
let studentCampaign = thisStudent.campaign;

document.getElementById("campaignTitle").innerHTML = studentCampaign;

let filteredCandidates = candidates.filter(c => c.campaign === studentCampaign);

let html = "";

filteredCandidates.forEach(c => {
    html += `
    <div style="border:1px solid #004aad; margin:8px; padding:7px;">
        <img src="${c.photo}" height="60"><br>
        <strong>${c.name}</strong><br>
        ${c.department}<br>
        <input type="radio" name="vote" value="${c.name}">
    </div>
    `;
});
document.getElementById("candidateList").innerHTML = html;

function submitVote(){
    let currentStudent = localStorage.getItem("currentStudent");
    let votedStudents = JSON.parse(localStorage.getItem("votedStudents")) || [];

    // ‚ùó CHECK if student has already voted
    if(votedStudents.includes(currentStudent)){
        alert("‚ùó You have already voted! Multiple voting is not allowed.");
        return;
    }

    // Check selected option
    let selectedCandidate = document.querySelector('input[name="vote"]:checked');

    if(!selectedCandidate){
        alert("Please choose a candidate to proceed.");
        return;
    }

    let choice = selectedCandidate.value;

    // Save vote  
    addVote(choice);

    // Mark student as having voted  
    votedStudents.push(currentStudent);
    localStorage.setItem("votedStudents", JSON.stringify(votedStudents));

    alert("Thanks for voting! Your vote has been recorded.");

    window.location.href = "student_dashboard.html";
}

function addVote(candidateName){
    let votes = JSON.parse(localStorage.getItem("votes")) || {};

    if(!votes[candidateName]){
        votes[candidateName] = 1;
    } else {
        votes[candidateName]++;
    }

    localStorage.setItem("votes", JSON.stringify(votes));
}


</script>

</body>
</html>
